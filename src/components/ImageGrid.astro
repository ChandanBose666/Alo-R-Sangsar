---
import products from "../data/products.json";

// Create carousel sets of 5 products (Desktop)
const itemsPerSlideDesktop = 5;
const slidesDesktop = [];
for (let i = 0; i < products.length; i += itemsPerSlideDesktop) {
  slidesDesktop.push(products.slice(i, i + itemsPerSlideDesktop));
}

// Create carousel sets of 3 products (Tablet)
const itemsPerSlideTablet = 3;
const slidesTablet = [];
for (let i = 0; i < products.length; i += itemsPerSlideTablet) {
  slidesTablet.push(products.slice(i, i + itemsPerSlideTablet));
}
---

<div class="container mx-auto px-4 py-8">
  <div class="relative w-full md:w-4/5 mx-auto">
    <!-- Desktop Carousel (5 items, XL+) -->
    <div
      id="desktop-carousel"
      class="hidden xl:block relative rounded-lg overflow-hidden min-h-[200px]"
    >
      <div class="relative w-full h-full">
        {
          slidesDesktop.map((slideProducts, slideIndex) => (
            <div
              data-slide
              class="absolute inset-0 transition-opacity duration-500 ease-in-out grid grid-cols-5 gap-3 p-2 opacity-0"
            >
              {slideProducts.map((product) => (
                <div class="group relative bg-white rounded-xl overflow-hidden aspect-square shadow-sm hover:shadow-xl transition-all duration-300">
                  <img
                    src={product.imageUrl}
                    alt={product.title}
                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                  />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4 text-white">
                    <h3 class="font-bold text-sm lg:text-base line-clamp-1">
                      {product.title}
                    </h3>
                    <p class="text-[10px] lg:text-xs opacity-80 line-clamp-1 mb-1">
                      {product.subtitle}
                    </p>
                    <p class="font-bold text-orange-400 text-sm">
                      ${product.price}
                    </p>
                  </div>
                </div>
              ))}
            </div>
          ))
        }
      </div>

      <button
        data-prev
        class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/60 hover:bg-white/90 rounded-full p-2 transition-all z-20"
      >
        <svg
          class="w-4 h-4 text-gray-800"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          ><path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path></svg
        >
      </button>
      <button
        data-next
        class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/60 hover:bg-white/90 rounded-full p-2 transition-all z-20"
      >
        <svg
          class="w-4 h-4 text-gray-800"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          ><path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"></path></svg
        >
      </button>

      <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2 z-20">
        {
          slidesDesktop.map((_, index) => (
            <button
              data-dot
              class="w-2 h-2 rounded-full bg-white/50 transition-all hover:bg-white/75"
              aria-label={`Go to slide ${index + 1}`}
            />
          ))
        }
      </div>
    </div>

    <!-- Tablet Carousel (3 items, MD to XL) -->
    <div
      id="tablet-carousel"
      class="hidden md:block xl:hidden relative rounded-lg overflow-hidden min-h-[200px]"
    >
      <div class="relative w-full h-full">
        {
          slidesTablet.map((slideProducts, slideIndex) => (
            <div
              data-slide
              class="absolute inset-0 transition-opacity duration-500 ease-in-out grid grid-cols-3 gap-3 p-2 opacity-0"
            >
              {slideProducts.map((product) => (
                <div class="group relative bg-white rounded-xl overflow-hidden aspect-square shadow-sm hover:shadow-xl transition-all duration-300">
                  <img
                    src={product.imageUrl}
                    alt={product.title}
                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                  />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4 text-white">
                    <h3 class="font-bold text-sm line-clamp-1">
                      {product.title}
                    </h3>
                    <p class="text-[10px] opacity-80 line-clamp-1 mb-1">
                      {product.subtitle}
                    </p>
                    <p class="font-bold text-orange-400 text-sm">
                      ${product.price}
                    </p>
                  </div>
                </div>
              ))}
            </div>
          ))
        }
      </div>

      <button
        data-prev
        class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/60 hover:bg-white/90 rounded-full p-2 transition-all z-20"
      >
        <svg
          class="w-4 h-4 text-gray-800"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          ><path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path></svg
        >
      </button>
      <button
        data-next
        class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/60 hover:bg-white/90 rounded-full p-2 transition-all z-20"
      >
        <svg
          class="w-4 h-4 text-gray-800"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          ><path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"></path></svg
        >
      </button>

      <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2 z-20">
        {
          slidesTablet.map((_, index) => (
            <button
              data-dot
              class="w-2 h-2 rounded-full bg-white/50 transition-all hover:bg-white/75"
              aria-label={`Go to slide ${index + 1}`}
            />
          ))
        }
      </div>
    </div>

    <!-- Mobile Carousel (1 item, Hidden on MD+) -->
    <div
      id="mobile-carousel"
      class="md:hidden relative rounded-lg overflow-hidden min-h-[300px]"
    >
      <div class="relative w-full h-full">
        {
          products.map((product) => (
            <div
              data-slide
              class="absolute inset-0 transition-opacity duration-500 ease-in-out p-2 opacity-0 flex justify-center items-center"
            >
              <div class="group relative bg-white rounded-2xl overflow-hidden aspect-square w-full max-w-[320px] shadow-lg">
                <img
                  src={product.imageUrl}
                  alt={product.title}
                  class="w-full h-full object-cover"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent flex flex-col justify-end p-6 text-white">
                  <h3 class="font-bold text-lg mb-1">{product.title}</h3>
                  <p class="text-sm opacity-90 mb-2">{product.subtitle}</p>
                  <p class="font-extrabold text-orange-400 text-xl">
                    ${product.price}
                  </p>
                </div>
              </div>
            </div>
          ))
        }
      </div>

      <button
        data-prev
        class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/60 hover:bg-white/90 rounded-full p-2 transition-all z-20"
      >
        <svg
          class="w-4 h-4 text-gray-800"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          ><path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path></svg
        >
      </button>
      <button
        data-next
        class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/60 hover:bg-white/90 rounded-full p-2 transition-all z-20"
      >
        <svg
          class="w-4 h-4 text-gray-800"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          ><path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"></path></svg
        >
      </button>

      <div
        class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2 z-20 flex-wrap justify-center max-w-[80%]"
      >
        {
          products.map((_, index) => (
            <button
              data-dot
              class="w-2 h-2 rounded-full bg-white/50 transition-all hover:bg-white/75"
              aria-label={`Go to image ${index + 1}`}
            />
          ))
        }
      </div>
    </div>
  </div>
</div>

<script src="../scripts/image-grid.ts"></script>
