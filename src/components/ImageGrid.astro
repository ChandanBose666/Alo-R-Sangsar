---
import products from "../data/products.json";

// Create carousel sets of 5 products (Desktop)
const itemsPerSlideDesktop = 5;
const slidesDesktop = [];
for (let i = 0; i < products.length; i += itemsPerSlideDesktop) {
  slidesDesktop.push(products.slice(i, i + itemsPerSlideDesktop));
}

// Create carousel sets of 3 products (Tablet)
const itemsPerSlideTablet = 3;
const slidesTablet = [];
for (let i = 0; i < products.length; i += itemsPerSlideTablet) {
  slidesTablet.push(products.slice(i, i + itemsPerSlideTablet));
}
---

<div class="container mx-auto px-4 py-12">
  <!-- Desktop Carousel (5 columns) -->
  <div id="desktop-carousel" class="hidden xl:block relative group mb-12">
    <div class="relative overflow-hidden min-h-[500px]">
      <div class="relative w-full h-full">
        {
          slidesDesktop.map((slideProducts, slideIndex) => (
            <div
              data-slide
              class="absolute inset-0 transition-opacity duration-500 ease-in-out grid grid-cols-5 gap-6 p-2 opacity-0"
            >
              {slideProducts.map((product) => (
                <div class="flex flex-col h-full bg-white group/card">
                  <div class="relative aspect-[4/5] bg-gray-50 rounded-lg overflow-hidden mb-4">
                    {product.badge && (
                      <span class="absolute top-3 left-3 bg-black text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider z-10">
                        {product.badge}
                      </span>
                    )}
                    <button class="absolute top-3 right-3 text-gray-400 hover:text-red-500 transition-colors z-10">
                      <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="1.5"
                          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                        />
                      </svg>
                    </button>
                    <img
                      src={product.imageUrl}
                      alt={product.title}
                      class="w-full h-full object-contain mix-blend-multiply transition-transform duration-500 group-hover/card:scale-105"
                    />
                  </div>

                  <div class="flex flex-col flex-grow">
                    <h3 class="text-sm font-medium text-gray-800 line-clamp-2 mb-1 min-h-[40px]">
                      {product.title}
                    </h3>

                    <div class="flex items-center gap-0.5 mb-2">
                      {[...Array(5)].map(() => (
                        <svg
                          class="w-3 h-3 text-green-500 fill-current"
                          viewBox="0 0 20 20"
                        >
                          <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
                        </svg>
                      ))}
                      <span class="text-[10px] text-gray-400 ml-1">(1)</span>
                    </div>

                    <div class="mb-2">
                      <span class="inline-block border border-red-500 text-red-500 text-[10px] font-bold px-2 py-0.5 rounded uppercase">
                        Sale
                      </span>
                    </div>

                    <div class="mt-auto">
                      <div class="flex items-baseline gap-2 mb-1">
                        <span class="text-lg font-bold text-gray-900">
                          ₹{product.price.toFixed(2)}
                        </span>
                        <span class="text-sm text-gray-400 line-through">
                          ₹{product.originalPrice.toFixed(2)}
                        </span>
                      </div>
                      <p class="text-xs text-red-600 font-semibold mb-4">
                        Save ₹
                        {(product.originalPrice - product.price).toFixed(2)} (
                        {product.discount})
                      </p>
                      <button class="w-full bg-black text-white py-3 text-xs font-bold uppercase tracking-widest hover:bg-gray-800 transition-colors rounded-sm">
                        Add to Basket
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ))
        }
      </div>
    </div>

    <!-- Controls Container -->
    <div class="flex items-center justify-between mt-8 px-2">
      <div class="flex gap-2">
        {
          slidesDesktop.map((_, index) => (
            <button
              data-dot
              class="w-2.5 h-2.5 rounded-full bg-gray-300 transition-all hover:bg-gray-400"
              aria-label={`Go to slide ${index + 1}`}
            />
          ))
        }
      </div>
      <div class="flex gap-1">
        <button
          data-prev
          class="border border-gray-200 hover:border-gray-900 p-2 transition-colors rounded-sm"
        >
          <svg
            class="w-4 h-4 text-gray-800"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path></svg
          >
        </button>
        <button
          data-next
          class="border border-gray-200 hover:border-gray-900 p-2 transition-colors rounded-sm"
        >
          <svg
            class="w-4 h-4 text-gray-800"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path></svg
          >
        </button>
      </div>
    </div>
  </div>

  <!-- Tablet Carousel (3 columns) -->
  <div
    id="tablet-carousel"
    class="hidden md:block xl:hidden relative group mb-12"
  >
    <div class="relative overflow-hidden min-h-[500px]">
      <div class="relative w-full h-full">
        {
          slidesTablet.map((slideProducts) => (
            <div
              data-slide
              class="absolute inset-0 transition-opacity duration-500 ease-in-out grid grid-cols-3 gap-6 p-2 opacity-0"
            >
              {slideProducts.map((product) => (
                <div class="flex flex-col h-full bg-white group/card">
                  <div class="relative aspect-[4/5] bg-gray-50 rounded-lg overflow-hidden mb-4">
                    <span class="absolute top-3 left-3 bg-black text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase z-10">
                      Offer
                    </span>
                    <button class="absolute top-3 right-3 text-gray-400">
                      <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="1.5"
                          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                        />
                      </svg>
                    </button>
                    <img
                      src={product.imageUrl}
                      alt={product.title}
                      class="w-full h-full object-contain mix-blend-multiply"
                    />
                  </div>
                  <h3 class="text-sm font-medium text-gray-800 line-clamp-2 mb-2 min-h-[40px]">
                    {product.title}
                  </h3>
                  <div class="mb-2">
                    <span class="border border-red-500 text-red-500 text-[10px] font-bold px-2 py-0.5 rounded uppercase">
                      Sale
                    </span>
                  </div>
                  <div class="mt-auto">
                    <div class="flex items-baseline gap-2 mb-1">
                      <span class="text-lg font-bold text-gray-900">
                        ₹{product.price.toFixed(2)}
                      </span>
                      <span class="text-sm text-gray-400 line-through">
                        ₹{product.originalPrice.toFixed(2)}
                      </span>
                    </div>
                    <p class="text-xs text-red-600 font-semibold mb-4">
                      Save ₹{(product.originalPrice - product.price).toFixed(2)}
                    </p>
                    <button class="w-full bg-black text-white py-3 text-xs font-bold uppercase tracking-widest rounded-sm">
                      Add to Basket
                    </button>
                  </div>
                </div>
              ))}
            </div>
          ))
        }
      </div>
    </div>
    <div class="flex items-center justify-between mt-8 px-2">
      <div class="flex gap-2">
        {
          slidesTablet.map((_, index) => (
            <button
              data-dot
              class="w-2.5 h-2.5 rounded-full bg-gray-300 transition-all hover:bg-gray-400"
              aria-label={`Go to slide ${index + 1}`}
            />
          ))
        }
      </div>
      <div class="flex gap-1">
        <button data-prev class="border border-gray-200 p-2 rounded-sm"
          ><svg
            class="w-4 h-4 text-gray-800"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path></svg
          ></button
        >
        <button data-next class="border border-gray-200 p-2 rounded-sm"
          ><svg
            class="w-4 h-4 text-gray-800"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path></svg
          ></button
        >
      </div>
    </div>
  </div>

  <!-- Mobile Carousel (1 column) -->
  <div id="mobile-carousel" class="md:hidden relative group">
    <div class="relative overflow-hidden min-h-[500px]">
      <div class="relative w-full h-full">
        {
          products.map((product) => (
            <div
              data-slide
              class="absolute inset-0 transition-opacity duration-500 ease-in-out p-2 opacity-0 flex justify-center"
            >
              <div class="w-full max-w-[300px] flex flex-col bg-white">
                <div class="relative aspect-[4/5] bg-gray-50 rounded-lg overflow-hidden mb-4">
                  <span class="absolute top-3 left-3 bg-black text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase z-10">
                    Offer
                  </span>
                  <img
                    src={product.imageUrl}
                    alt={product.title}
                    class="w-full h-full object-contain mix-blend-multiply"
                  />
                </div>
                <h3 class="text-sm font-medium text-gray-800 line-clamp-2 mb-1">
                  {product.title}
                </h3>
                <div class="flex items-center justify-center gap-0.5 mb-2">
                  {[...Array(5)].map(() => (
                    <svg
                      class="w-2.5 h-2.5 text-green-500 fill-current"
                      viewBox="0 0 20 20"
                    >
                      <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
                    </svg>
                  ))}
                  <span class="text-[8px] text-gray-400 ml-1">(1)</span>
                </div>
                <div class="flex items-baseline gap-2 mb-1">
                  <span class="text-lg font-bold text-gray-900">
                    ₹{product.price.toFixed(2)}
                  </span>
                  <span class="text-xs text-gray-400 line-through">
                    ₹{product.originalPrice.toFixed(2)}
                  </span>
                </div>
                <p class="text-[10px] text-red-600 font-semibold mb-4">
                  Save ₹{(product.originalPrice - product.price).toFixed(2)}
                </p>
                <button class="w-full bg-black text-white py-3 text-xs font-bold uppercase tracking-widest rounded-sm">
                  Add to Basket
                </button>
              </div>
            </div>
          ))
        }
      </div>
    </div>
    <div class="flex items-center justify-between mt-8 px-2">
      <div class="flex gap-2 flex-wrap justify-center max-w-[70%]">
        {
          products.map((_, index) => (
            <button
              data-dot
              class="w-2 h-2 rounded-full bg-gray-300 transition-all hover:bg-gray-400"
              aria-label={`Go to image ${index + 1}`}
            />
          ))
        }
      </div>
      <div class="flex gap-1">
        <button data-prev class="border border-gray-200 p-2 rounded-sm"
          ><svg
            class="w-4 h-4 text-gray-800"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path></svg
          ></button
        >
        <button data-next class="border border-gray-200 p-2 rounded-sm"
          ><svg
            class="w-4 h-4 text-gray-800"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path></svg
          ></button
        >
      </div>
    </div>
  </div>
</div>

<script src="../scripts/image-grid.ts"></script>
