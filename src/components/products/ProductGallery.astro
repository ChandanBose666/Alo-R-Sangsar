---
interface Props {
  mainImage: string;
  images: string[];
  title: string;
}

const { mainImage, images, title } = Astro.props;
---

<div class="space-y-6">
  <div
    class="relative bg-gray-50 rounded-xl overflow-hidden aspect-square group cursor-zoom-in"
  >
    <img
      id="main-image"
      src={mainImage}
      alt={title}
      class="w-full h-full object-contain mix-blend-multiply transition-all duration-700 ease-in-out group-hover:scale-105"
    />

    <!-- Zoom Button -->
    <button
      class="absolute top-6 right-6 p-3 bg-white border border-gray-100 rounded-lg shadow-sm hover:shadow-md transition-all active:scale-95"
    >
      <svg
        class="w-5 h-5 text-gray-900"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"
        ></path>
      </svg>
    </button>

    <!-- Navigation Arrows -->
    <button
      id="prev-image"
      class="absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-white/80 backdrop-blur-sm rounded-full opacity-0 group-hover:opacity-100 transition-all hover:bg-white shadow-sm -translate-x-4 group-hover:translate-x-0 z-10"
    >
      <svg
        class="w-6 h-6 text-gray-900"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        ><path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"></path></svg
      >
    </button>
    <button
      id="next-image"
      class="absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-white/80 backdrop-blur-sm rounded-full opacity-0 group-hover:opacity-100 transition-all hover:bg-white shadow-sm translate-x-4 group-hover:translate-x-0 z-10"
    >
      <svg
        class="w-6 h-6 text-gray-900"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        ><path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"></path></svg
      >
    </button>
  </div>

  <!-- Thumbnails -->
  <div
    class="flex gap-4 overflow-x-auto pb-2 scrollbar-hide"
    id="thumbnail-container"
    data-images={JSON.stringify(images || [])}
  >
    {
      images?.map((img, index) => (
        <button
          data-img-src={img}
          data-index={index}
          class={`thumb-btn flex-shrink-0 w-24 h-24 rounded-lg bg-gray-50 p-2 border-2 transition-all ${index === 0 ? "border-black" : "border-transparent hover:border-gray-300"}`}
        >
          <img
            src={img}
            alt={`${title} thumbnail ${index + 1}`}
            class="w-full h-full object-contain mix-blend-multiply pointer-events-none"
          />
        </button>
      ))
    }
  </div>
</div>

<style>
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  function setupGallery() {
    const mainImage = document.getElementById("main-image") as HTMLImageElement;
    const thumbBtns = document.querySelectorAll(".thumb-btn");
    const prevBtn = document.getElementById("prev-image");
    const nextBtn = document.getElementById("next-image");
    const thumbContainer = document.getElementById("thumbnail-container");

    if (!mainImage || !thumbContainer) return;

    const images = JSON.parse(
      thumbContainer.getAttribute("data-images") || "[]",
    );
    let currentIndex = 0;

    function updateGallery(index: number) {
      if (index < 0 || index >= images.length) return;
      currentIndex = index;

      mainImage.style.opacity = "0";
      mainImage.style.transform = "scale(0.98)";

      setTimeout(() => {
        mainImage.src = images[currentIndex];
        mainImage.style.opacity = "1";
        mainImage.style.transform = "scale(1)";
      }, 150);

      thumbBtns.forEach((btn, i) => {
        if (i === currentIndex) {
          btn.classList.add("border-black");
          btn.classList.remove("border-transparent");
          btn.scrollIntoView({
            behavior: "smooth",
            block: "nearest",
            inline: "center",
          });
        } else {
          btn.classList.remove("border-black");
          btn.classList.add("border-transparent");
        }
      });
    }

    thumbBtns.forEach((btn, index) => {
      btn.addEventListener("click", () => updateGallery(index));
    });

    prevBtn?.addEventListener("click", () => {
      let nextIndex = currentIndex - 1;
      if (nextIndex < 0) nextIndex = images.length - 1;
      updateGallery(nextIndex);
    });

    nextBtn?.addEventListener("click", () => {
      let nextIndex = currentIndex + 1;
      if (nextIndex >= images.length) nextIndex = 0;
      updateGallery(nextIndex);
    });
  }

  setupGallery();
  document.addEventListener("astro:after-swap", setupGallery);
</script>
